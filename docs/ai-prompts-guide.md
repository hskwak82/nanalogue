# 나날로그 AI 프롬프트 가이드

## 개요

나날로그 앱은 AI와의 대화를 통해 자연스럽게 일기를 작성하는 서비스입니다. 이 문서는 앱에서 사용하는 AI 프롬프트의 구조와 역할을 설명합니다.

- **총 11개 프롬프트**, 3개 카테고리
- 각 프롬프트는 독립적으로 수정 가능
- 변수 치환을 통해 동적 콘텐츠 삽입 지원
- 버전 관리 및 롤백 기능 제공

---

## 카테고리별 프롬프트 요약

### 대화 (chat) - 8개

사용자와 AI가 대화하며 하루를 돌아보는 과정에서 사용됩니다.

| 키 | 이름 | 변수 | 영향 범위 |
|---|---|---|---|
| `chat.personality` | AI 성격 정의 | 없음 | 모든 대화 응답의 톤과 스타일 |
| `chat.greeting` | 첫 인사말 | 없음 | 대화 시작 시 표시되는 첫 메시지 |
| `chat.closing` | 종료 메시지 | 없음 | 7회 이상 대화 후 종료 시 메시지 |
| `chat.phase_early` | 초반 대화 가이드 | 없음 | 질문 1-2회 단계 |
| `chat.phase_mid` | 중반 대화 가이드 | 없음 | 질문 3-4회 단계 |
| `chat.phase_late` | 후반 대화 가이드 | 없음 | 질문 5회 이상 단계 |
| `chat.schedule_detection` | 일정 감지 규칙 | `{{today}}` | 미래 일정 파싱 로직 |
| `chat.response_format` | 응답 형식 | 없음 | AI 응답의 JSON 구조 정의 |

### 일기 (diary) - 2개

대화 내용을 바탕으로 일기를 생성할 때 사용됩니다.

| 키 | 이름 | 변수 | 영향 범위 |
|---|---|---|---|
| `diary.write_style` | 일기 작성 스타일 | `{{dateInfo}}` | 일기 본문 생성 스타일 |
| `diary.metadata_extraction` | 메타데이터 추출 | 없음 | 감정/요약/감사/내일 계획 추출 |

### 일정 (schedule) - 1개

사용자 입력에서 캘린더 일정을 추출할 때 사용됩니다.

| 키 | 이름 | 변수 | 영향 범위 |
|---|---|---|---|
| `schedule.parsing` | 일정 파싱 프롬프트 | `{{referenceDate}}`, `{{currentScheduleContext}}`, `{{conversationContext}}` | 일정 정보 추출 로직 |

---

## 각 프롬프트 상세 설명

### 1. chat.personality (AI 성격 정의)

**목적**: AI의 전반적인 성격과 대화 스타일을 정의합니다.

**영향 범위**: 모든 대화 응답에 적용되어 AI의 톤, 말투, 공감 방식을 결정합니다.

**사용 위치**: `/api/chat/next-question`

**현재 내용**:
```
당신은 따뜻하고 공감 능력이 뛰어난 친구 같은 AI입니다.
사용자의 하루를 자연스럽게 들으면서 일기 작성을 위한 정보를 모읍니다.

중요 지침:
1. 먼저 사용자가 방금 말한 내용에 대해 짧게 공감하거나 반응해주세요
2. 그 다음 자연스럽게 이어지는 질문을 해주세요
3. 마치 친한 친구와 대화하듯 편안하고 자연스럽게 대화하세요
4. 너무 형식적이거나 딱딱하지 않게, 구어체로 말하세요
5. 이모지나 특수문자는 사용하지 마세요 (음성으로 읽힙니다)
```

**작성 가이드라인**:
- 이모지 사용 금지 (TTS로 읽히기 때문)
- 구어체 사용 권장
- 공감 + 질문 구조 유지

---

### 2. chat.greeting (첫 인사말)

**목적**: 대화 시작 시 AI가 보내는 첫 메시지입니다.

**영향 범위**: 사용자가 대화 세션을 시작할 때 한 번만 표시됩니다.

**사용 위치**: `/api/chat/next-question` (questionCount === 0일 때)

**현재 내용**:
```
안녕하세요! 오늘 하루는 어떠셨나요? 편하게 이야기해 주세요.
```

**작성 가이드라인**:
- 친근하고 개방형 질문으로 시작
- 짧고 부담 없는 길이
- 이모지 사용 금지

---

### 3. chat.closing (종료 메시지)

**목적**: 충분한 대화 후 세션을 종료할 때 표시되는 메시지입니다.

**영향 범위**: 7회 이상 대화 후 일기 생성으로 전환될 때 표시됩니다.

**사용 위치**: `/api/chat/next-question` (questionCount >= 7일 때)

**현재 내용**:
```
오늘 이야기 나눠주셔서 감사해요. 이제 말씀해주신 내용을 바탕으로 오늘의 일기를 작성해 드릴게요.
```

**작성 가이드라인**:
- 감사 표현 포함
- 다음 단계(일기 작성) 안내
- 따뜻한 마무리 느낌

---

### 4. chat.phase_early (초반 대화 가이드)

**목적**: 대화 초반(질문 1-2회)에 AI가 어떤 방향으로 대화할지 안내합니다.

**영향 범위**: 시스템 프롬프트로 AI에게 전달되어 질문 방향을 결정합니다.

**현재 내용**:
```
초반 대화: 사용자의 하루 전반적인 기분과 주요 일과를 파악하세요.
```

**작성 가이드라인**:
- 전반적인 하루 파악에 집중
- 너무 구체적인 질문보다 개방형 유도

---

### 5. chat.phase_mid (중반 대화 가이드)

**목적**: 대화 중반(질문 3-4회)에 AI가 더 깊이 탐색하도록 안내합니다.

**영향 범위**: 사용자가 언급한 특정 주제를 더 탐구하도록 유도합니다.

**현재 내용**:
```
중반 대화: 사용자가 언급한 내용 중 흥미로운 부분을 더 깊이 탐색하세요. 감정이나 구체적인 상황을 물어보세요.
```

**작성 가이드라인**:
- 감정 탐구 유도
- 구체적인 상황 질문 권장

---

### 6. chat.phase_late (후반 대화 가이드)

**목적**: 대화 후반(질문 5회 이상)에 하루를 마무리하는 질문을 유도합니다.

**영향 범위**: 감사, 교훈, 내일 계획 등 마무리 주제로 이끕니다.

**현재 내용**:
```
후반 대화: 감사했던 점, 내일 계획, 또는 오늘의 교훈 등 하루를 마무리하는 질문을 하세요.
```

**작성 가이드라인**:
- 긍정적인 마무리 유도
- 내일에 대한 기대감 형성

---

### 7. chat.schedule_detection (일정 감지 규칙)

**목적**: 대화에서 미래 일정을 감지하고 추출하는 규칙을 정의합니다.

**변수**:
- `{{today}}`: 오늘 날짜 (YYYY-MM-DD 형식)

**영향 범위**: AI가 대화에서 캘린더에 추가할 일정을 인식하는 로직입니다.

**현재 내용**:
```
일정 감지 및 추가 질문 지침:
- **미래 일정만** 감지하세요! 과거에 있었던 일은 일정이 아닙니다.
- 미래 일정 예시 (감지해야 함): "내일 3시에 회의 있어", "다음주 월요일 점심 약속"
- 과거 사건 예시 (감지하면 안됨): "오늘 1시간 미팅했어", "아까 3시에 회의했어"
- 오늘 날짜: {{today}}
- 상대적 날짜를 절대 날짜(YYYY-MM-DD)로 변환하세요

일정 정보가 부족할 때:
- 시간이 없으면: "몇 시에 잡을까요?" 또는 "몇 시쯤이에요?"
- 소요시간이 불명확하면: "대략 몇 시간 정도 예상하세요?"
```

**작성 가이드라인**:
- 과거/미래 구분 명확히
- 날짜 변환 규칙 구체적으로
- 부족한 정보 질문 패턴 제공

---

### 8. chat.response_format (응답 형식)

**목적**: AI 응답의 JSON 구조를 정의합니다.

**영향 범위**: AI가 반환하는 데이터 형식을 결정합니다.

**현재 내용**:
```
응답 형식 (반드시 JSON으로):
{
  "question": "공감 + 질문 내용 (2-3문장, 이모지 없이)",
  "detectedSchedules": [...],
  "updatedPendingSchedule": null 또는 {...}
}
```

**작성 가이드라인**:
- JSON 스키마 명확히 정의
- 필수/선택 필드 구분
- 예시 값 제공

---

### 9. diary.write_style (일기 작성 스타일)

**목적**: 대화 내용을 바탕으로 일기를 생성할 때의 스타일을 정의합니다.

**변수**:
- `{{dateInfo}}`: 작성일시 정보 (예: "작성: 2025년 12월 27일 15시 30분")

**영향 범위**: 생성되는 일기의 문체, 형식, 길이를 결정합니다.

**사용 위치**: `/api/diary/generate`

**현재 내용**:
```
대화 내용을 바탕으로 1인칭 일기를 작성해주세요.
- 첫 줄에 "{{dateInfo}}" 표시
- 편안한 구어체, 2-3문단
- 감정과 생각을 자연스럽게 표현
일기 본문만 작성하세요.
```

**작성 가이드라인**:
- 1인칭 시점 유지
- 구어체 권장
- 적절한 길이 지정

---

### 10. diary.metadata_extraction (메타데이터 추출)

**목적**: 생성된 일기에서 메타데이터를 추출합니다.

**영향 범위**: 일기 저장 시 함께 저장되는 요약, 감정 태그, 감사 목록, 내일 계획을 결정합니다.

**사용 위치**: `/api/diary/generate`

**현재 내용**:
```
다음 일기를 분석해서 JSON으로 응답하세요:
{"summary":"한줄요약","emotions":["감정태그"],"gratitude":["감사한점"],"tomorrow_plan":"내일다짐"}
```

**작성 가이드라인**:
- JSON 응답 형식 명확히
- 각 필드의 내용 설명

---

### 11. schedule.parsing (일정 파싱 프롬프트)

**목적**: 사용자 입력에서 캘린더 일정 정보를 추출합니다.

**변수**:
- `{{referenceDate}}`: 기준 날짜 (오늘)
- `{{currentScheduleContext}}`: 현재 수집 중인 일정 컨텍스트
- `{{conversationContext}}`: 대화 맥락

**영향 범위**: 일정 추출의 정확도와 누락 정보 질문 로직을 결정합니다.

**현재 내용**: (긴 프롬프트로 인해 생략, 관리자 페이지에서 확인 가능)

**작성 가이드라인**:
- 날짜/시간 변환 규칙 명확히
- 필수 정보 우선순위 정의
- 자연스러운 추가 질문 예시 제공

---

## JSON 파일 형식

### 내보내기 파일 구조

```json
{
  "version": "1.0",
  "exportedAt": "2025-12-27T08:00:00Z",
  "prompts": [
    {
      "prompt_key": "chat.personality",
      "category": "chat",
      "name": "AI 성격 정의",
      "description": "AI의 전반적인 성격과 대화 스타일을 정의합니다",
      "content": "당신은 따뜻하고 공감 능력이 뛰어난...",
      "variables": []
    },
    {
      "prompt_key": "chat.schedule_detection",
      "category": "chat",
      "name": "일정 감지 규칙",
      "description": "대화에서 미래 일정을 감지하는 규칙입니다",
      "content": "일정 감지 및 추가 질문 지침:...",
      "variables": ["{{today}}"]
    }
  ]
}
```

### 가져오기 시 주의사항

1. `prompt_key`는 기존 프롬프트와 정확히 일치해야 합니다
2. `content`가 변경된 프롬프트만 업데이트됩니다
3. 새 프롬프트 추가는 지원되지 않습니다 (기존 키만 업데이트)
4. 업데이트 시 자동으로 새 버전이 생성됩니다

---

## 프롬프트 작성 시 일반 가이드라인

### DO (권장)
- 명확하고 구체적인 지시어 사용
- 예시 포함
- JSON 형식이 필요할 때 스키마 명시
- 한국어로 작성 (앱 대상 사용자가 한국어권)

### DON'T (금지)
- 이모지 사용 (TTS 호환성 문제)
- 모호한 지시
- 너무 긴 프롬프트 (토큰 비용 증가)
- 영어와 한국어 혼용

---

## 변수 사용법

변수는 `{{변수명}}` 형식으로 사용합니다. 런타임에 실제 값으로 치환됩니다.

| 변수 | 설명 | 예시 값 |
|------|------|---------|
| `{{today}}` | 오늘 날짜 | `2025-12-27` |
| `{{dateInfo}}` | 작성일시 정보 | `작성: 2025년 12월 27일 15시 30분` |
| `{{referenceDate}}` | 기준 날짜 | `2025-12-27` |
| `{{currentScheduleContext}}` | 현재 일정 컨텍스트 | 수집 중인 일정 정보 |
| `{{conversationContext}}` | 대화 맥락 | 이전 대화 내용 |

---

## 관련 파일

- **관리 페이지**: `/settings/admin/prompts`
- **API 엔드포인트**:
  - `GET /api/admin/prompts` - 프롬프트 목록
  - `PUT /api/admin/prompts/[id]` - 프롬프트 수정
  - `POST /api/admin/prompts/[id]/rollback` - 버전 롤백
  - `GET /api/admin/prompts/export` - JSON 내보내기
  - `POST /api/admin/prompts/import` - JSON 가져오기
- **라이브러리**: `/src/lib/ai-prompts.ts`
- **타입 정의**: `/src/types/ai-prompts.ts`
